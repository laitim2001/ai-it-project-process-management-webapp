# æ¸¬è©¦å ±å‘Š: å ±åƒ¹å–® + æ¡è³¼å–® + æ”¯å‡ºç®¡ç†æ¨¡çµ„

> **æ¸¬è©¦æ—¥æœŸ**: 2025-11-11
> **æ¸¬è©¦äººå“¡**: AI åŠ©æ‰‹
> **æ¸¬è©¦ç’°å¢ƒ**: http://localhost:3001 (é–‹ç™¼ç’°å¢ƒ)
> **æ¸¬è©¦ç¯„åœ**: Quotes, Purchase Orders, Expenses æ¨¡çµ„ç¨‹å¼ç¢¼å¯©æŸ¥

---

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦

### æ¸¬è©¦æ¨¡çµ„
1. **å ±åƒ¹å–® (Quotes)**: quote.ts (513 è¡Œ)
2. **æ¡è³¼å–® (Purchase Orders)**: purchaseOrder.ts (659 è¡Œ)
3. **æ”¯å‡ºç®¡ç† (Expenses)**: expense.ts (934 è¡Œ)

### æ¸¬è©¦ç‹€æ…‹
- âœ… ç¨‹å¼ç¢¼å¯©æŸ¥: å·²å®Œæˆ (ä¸‰å€‹æ¨¡çµ„)
- â³ æ‰‹å‹•æ¸¬è©¦: å¾…åŸ·è¡Œ

---

## ğŸ” ç¨‹å¼ç¢¼å¯©æŸ¥ç™¼ç¾

### 1. âœ… å ±åƒ¹å–®æ¨¡çµ„ (`quote.ts` - 513 è¡Œ)

**API è·¯ç”±** (9 å€‹):
1. `getAll` - ç²å–æ‰€æœ‰å ±åƒ¹å–® (åˆ†é ã€å°ˆæ¡ˆ/ä¾›æ‡‰å•†ç¯©é¸)
2. `getByProject` - æ ¹æ“šå°ˆæ¡ˆæŸ¥è©¢å ±åƒ¹å–®
3. `getByVendor` - æ ¹æ“šä¾›æ‡‰å•†æŸ¥è©¢å ±åƒ¹å–®
4. `getById` - ç²å–å–®å€‹å ±åƒ¹å–®è©³æƒ…
5. `create` - å‰µå»ºå ±åƒ¹å–® (æª¢æŸ¥å°ˆæ¡ˆæ˜¯å¦æœ‰å·²æ‰¹å‡†ææ¡ˆ)
6. `update` - æ›´æ–°å ±åƒ¹å–® (å·²è¢«é¸ç‚º PO å‰‡ä¸èƒ½ä¿®æ”¹)
7. `delete` - åˆªé™¤å ±åƒ¹å–® (å·²è¢«é¸ç‚º PO å‰‡ä¸èƒ½åˆªé™¤)
8. `compare` - æ¯”è¼ƒå°ˆæ¡ˆçš„æ‰€æœ‰å ±åƒ¹å–® (æŒ‰é‡‘é¡æ’åº)
9. `getStats` - ç²å–å ±åƒ¹å–®çµ±è¨ˆè³‡è¨Š

**å„ªé»**:
- âœ… **å®Œæ•´çš„æ¥­å‹™é‚è¼¯**: åªæœ‰å·²æ‰¹å‡†ææ¡ˆçš„å°ˆæ¡ˆæ‰èƒ½ä¸Šå‚³å ±åƒ¹å–®
- âœ… **ä¿è­·é‚è¼¯**: å·²è¢«é¸ç‚º PO çš„å ±åƒ¹å–®ä¸èƒ½ä¿®æ”¹/åˆªé™¤
- âœ… **æ¯”è¼ƒåŠŸèƒ½**: æ”¯æ´å ±åƒ¹æ¯”è¼ƒ,è¨ˆç®—çµ±è¨ˆè³‡è¨Š (å¹³å‡ã€æœ€å°ã€æœ€å¤§é‡‘é¡)
- âœ… **Zod é©—è­‰**: å®Œæ•´çš„è¼¸å…¥é©—è­‰
- âœ… **éŒ¯èª¤è™•ç†**: æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯

---

### 2. âœ… æ¡è³¼å–®æ¨¡çµ„ (`purchaseOrder.ts` - 659 è¡Œ)

**API è·¯ç”±** (10 å€‹):
1. `getAll` - ç²å–æ‰€æœ‰æ¡è³¼å–® (åˆ†é ã€å°ˆæ¡ˆ/ä¾›æ‡‰å•†ç¯©é¸ã€æ’åº)
2. `getById` - ç²å–å–®å€‹æ¡è³¼å–®è©³æƒ… (å«æ˜ç´°)
3. `create` - å‰µå»ºæ¡è³¼å–® (Module 4: è¡¨é ­-æ˜ç´°çµæ§‹)
4. `update` - æ›´æ–°æ¡è³¼å–® (Module 4: æ”¯æŒæ˜ç´°æ–°å¢ã€æ›´æ–°ã€åˆªé™¤)
5. `delete` - åˆªé™¤æ¡è³¼å–® (æª¢æŸ¥é—œè¯çš„ Expense)
6. `getByProject` - æ ¹æ“šå°ˆæ¡ˆæŸ¥è©¢æ¡è³¼å–®
7. `submit` - æäº¤æ¡è³¼å–® (Draft â†’ Submitted)
8. `approve` - æ‰¹å‡†æ¡è³¼å–® (Submitted â†’ Approved, supervisorProcedure)
9. `getStats` - ç²å–æ¡è³¼å–®çµ±è¨ˆè³‡è¨Š

**å„ªé»**:
- âœ… **Module 4 é‡æ§‹**: è¡¨é ­-æ˜ç´°çµæ§‹å®Œæ•´å¯¦ç¾
- âœ… **Transaction ä¿è­‰**: ä½¿ç”¨ `$transaction` ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- âœ… **æ˜ç´°ç®¡ç†**: æ”¯æŒæ˜ç´°çš„æ–°å¢ã€æ›´æ–°ã€åˆªé™¤ (æ¨™è¨˜åˆªé™¤)
- âœ… **è‡ªå‹•è¨ˆç®—**: ç¸½é‡‘é¡è‡ªå‹•å¾æ˜ç´°ç´¯åŠ 
- âœ… **ç‹€æ…‹å·¥ä½œæµ**: Draft â†’ Submitted â†’ Approved
- âœ… **æ¬Šé™æ§åˆ¶**: approve ä½¿ç”¨ supervisorProcedure
- âœ… **é—œè¯è³‡æ–™æª¢æŸ¥**: åˆªé™¤å‰æª¢æŸ¥æ˜¯å¦æœ‰é—œè¯çš„ Expense

**PO Items Schema**:
```typescript
{
  itemName, description, quantity, unitPrice,
  subtotal (è‡ªå‹•è¨ˆç®— = quantity * unitPrice),
  sortOrder, _delete (æ¨™è¨˜åˆªé™¤)
}
```

---

### 3. âœ… æ”¯å‡ºç®¡ç†æ¨¡çµ„ (`expense.ts` - 934 è¡Œ)

**API è·¯ç”±** (10 å€‹):
1. `getAll` - ç²å–æ‰€æœ‰æ”¯å‡º (åˆ†é ã€PO/ç‹€æ…‹ç¯©é¸ã€æ’åº)
2. `getById` - ç²å–å–®å€‹æ”¯å‡ºè©³æƒ… (å«æ˜ç´°)
3. `create` - å‰µå»ºæ”¯å‡º (Module 5: è¡¨é ­-æ˜ç´°çµæ§‹)
4. `update` - æ›´æ–°æ”¯å‡º (Module 5: æ”¯æŒæ˜ç´°æ–°å¢ã€æ›´æ–°ã€åˆªé™¤)
5. `delete` - åˆªé™¤æ”¯å‡º (åƒ… Draft ç‹€æ…‹å¯åˆªé™¤)
6. `submit` - æäº¤æ”¯å‡ºå¯©æ‰¹ (Draft â†’ Submitted, ç™¼é€é€šçŸ¥)
7. `approve` - æ‰¹å‡†æ”¯å‡º (Submitted â†’ Approved, supervisorProcedure, å¾é ç®—æ± æ‰£æ¬¾)
8. `reject` - æ‹’çµ•æ”¯å‡º (Submitted â†’ Draft, ç™¼é€é€šçŸ¥)
9. `markAsPaid` - æ¨™è¨˜ç‚ºå·²æ”¯ä»˜ (Approved â†’ Paid)
10. `getByPurchaseOrder` - æ ¹æ“šæ¡è³¼å–®æŸ¥è©¢æ”¯å‡º
11. `getStats` - ç²å–æ”¯å‡ºçµ±è¨ˆè³‡è¨Š

**å„ªé»**:
- âœ… **Module 5 é‡æ§‹**: è¡¨é ­-æ˜ç´°çµæ§‹å®Œæ•´å¯¦ç¾
- âœ… **Transaction ä¿è­‰**: ä½¿ç”¨ `$transaction` ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- âœ… **é ç®—æ± æ‰£æ¬¾**: æ‰¹å‡†æ™‚å¾ BudgetPool å’Œ BudgetCategory æ‰£æ¬¾
- âœ… **ç‹€æ…‹å·¥ä½œæµ**: Draft â†’ Submitted â†’ Approved â†’ Paid
- âœ… **Epic 8 æ•´åˆ**: æäº¤ã€æ‰¹å‡†ã€æ‹’çµ•æ™‚ç™¼é€é€šçŸ¥
- âœ… **æ¬Šé™æ§åˆ¶**: approve å’Œ reject ä½¿ç”¨ supervisorProcedure
- âœ… **é ç®—æª¢æŸ¥**: æ‰¹å‡†å‰æª¢æŸ¥é ç®—æ± é¤˜é¡æ˜¯å¦è¶³å¤ 
- âœ… **æ˜ç´°ç®¡ç†**: æ”¯æŒæ˜ç´°çš„æ–°å¢ã€æ›´æ–°ã€åˆªé™¤

**Expense Items Schema**:
```typescript
{
  itemName, description, amount, category,
  sortOrder, _delete (æ¨™è¨˜åˆªé™¤)
}
```

**é ç®—æ‰£æ¬¾é‚è¼¯** (è¡Œ 673-713):
```typescript
// 1. æ›´æ–°è²»ç”¨ç‹€æ…‹ç‚º Approved
// 2. å¾ BudgetPool.usedAmount æ‰£æ¬¾
// 3. å¾ BudgetCategory.usedAmount æ‰£æ¬¾ (å¦‚æœæœ‰ budgetCategoryId)
// 4. ç™¼é€é€šçŸ¥çµ¦ Project Manager
```

---

## ğŸ› å·²è­˜åˆ¥å•é¡Œ

### ğŸŸ¡ P2 å•é¡Œ 1: Expense getById ä½¿ç”¨äº†å·²ç§»é™¤çš„æ¬„ä½

**æª”æ¡ˆ**: `packages/api/src/routers/expense.ts:458-463`

**å•é¡Œæè¿°**:
`getById` API çš„ include ä¸­åŒ…å« `project` æ¬„ä½,ä½† Expense model å·²ç¶“æ²’æœ‰ `projectId` æ¬„ä½ (æ ¹æ“šè¨»è§£ line 294: "projectId ä¸å­˜åœ¨æ–¼ Expense model")ã€‚

**ç¨‹å¼ç¢¼** (è¡Œ 458-463):
```typescript
include: {
  items: { orderBy: { sortOrder: 'asc' } },
  project: {  // âŒ Expense å·²æ²’æœ‰ project é—œè¯
    select: {
      id: true,
      name: true,
    },
  },
  purchaseOrder: { /* ... */ },
  vendor: { /* ... */ },
  budgetCategory: { /* ... */ },
}
```

**å½±éŸ¿ç¯„åœ**: `expense.getById` API,å¯èƒ½å°è‡´æŸ¥è©¢éŒ¯èª¤

**å„ªå…ˆç´š**: ğŸŸ¡ P2 (ä¸­å„ªå…ˆç´š - å½±éŸ¿å–®ä¸€ API)

**å»ºè­°ä¿®å¾©**:
```typescript
include: {
  items: { orderBy: { sortOrder: 'asc' } },
  // ç§»é™¤ project é—œè¯,æ”¹ç‚ºé€šé purchaseOrder.project æŸ¥è©¢
  purchaseOrder: {
    include: {
      project: {
        include: {
          budgetPool: true,
          manager: {
            select: {
              id: true,
              name: true,
              email: true,
            },
          },
          supervisor: {
            select: {
              id: true,
              name: true,
              email: true,
            },
          },
        },
      },
      vendor: true,
      quote: {
        select: {
          id: true,
          amount: true,
          filePath: true,
        },
      },
    },
  },
  vendor: {
    select: {
      id: true,
      name: true,
    },
  },
  budgetCategory: {
    select: {
      id: true,
      categoryName: true,
    },
  },
}
```

---

### ğŸŸ¡ P2 å•é¡Œ 2: Expense update API ä½¿ç”¨äº†å·²ç§»é™¤çš„æ¬„ä½

**æª”æ¡ˆ**: `packages/api/src/routers/expense.ts:454-477`

**å•é¡Œæè¿°**:
`update` API çš„ include ä¸­ä¹ŸåŒ…å« `project` æ¬„ä½,èˆ‡å•é¡Œ 1 ç›¸åŒã€‚

**ç¨‹å¼ç¢¼** (è¡Œ 458-463):
```typescript
include: {
  items: { orderBy: { sortOrder: 'asc' } },
  project: {  // âŒ Expense å·²æ²’æœ‰ project é—œè¯
    select: {
      id: true,
      name: true,
    },
  },
  purchaseOrder: { /* ... */ },
  vendor: { /* ... */ },
}
```

**å½±éŸ¿ç¯„åœ**: `expense.update` API,å¯èƒ½å°è‡´æŸ¥è©¢éŒ¯èª¤

**å„ªå…ˆç´š**: ğŸŸ¡ P2 (ä¸­å„ªå…ˆç´š - å½±éŸ¿å–®ä¸€ API)

**å»ºè­°ä¿®å¾©**: åŒå•é¡Œ 1

---

### âš ï¸ å…¶ä»–æ¨¡çµ„ç„¡å•é¡Œ

- **å ±åƒ¹å–®æ¨¡çµ„**: âœ… æœªç™¼ç¾å•é¡Œ
- **æ¡è³¼å–®æ¨¡çµ„**: âœ… æœªç™¼ç¾å•é¡Œ

---

## ğŸ“Š å¯©æŸ¥çµ±è¨ˆ

### å®Œæˆåº¦
- **ç¨‹å¼ç¢¼å¯©æŸ¥**: 100% (ä¸‰å€‹æ¨¡çµ„å…± 2106 è¡Œ)
- **API å¯©æŸ¥**: 100% (29 å€‹ API ç«¯é»å…¨éƒ¨å¯©æŸ¥)

### å•é¡Œçµ±è¨ˆ
- **ğŸ”´ P0 Critical**: 0 å€‹
- **ğŸŸ  P1 High**: 0 å€‹
- **ğŸŸ¡ P2 Medium**: 2 å€‹ (Expense getById, Expense update - include æ¬„ä½éŒ¯èª¤)
- **ğŸŸ¢ P3 Low**: 0 å€‹

---

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### å ±åƒ¹å–®æ¨¡çµ„æ¸¬è©¦
- [ ] **å‰µå»ºå ±åƒ¹å–®**: é©—è­‰åªæœ‰å·²æ‰¹å‡†ææ¡ˆçš„å°ˆæ¡ˆå¯ä¸Šå‚³
- [ ] **æ›´æ–°å ±åƒ¹å–®**: é©—è­‰å·²è¢«é¸ç‚º PO çš„å ±åƒ¹å–®ä¸èƒ½ä¿®æ”¹
- [ ] **åˆªé™¤å ±åƒ¹å–®**: é©—è­‰å·²è¢«é¸ç‚º PO çš„å ±åƒ¹å–®ä¸èƒ½åˆªé™¤
- [ ] **å ±åƒ¹æ¯”è¼ƒ**: é©—è­‰çµ±è¨ˆè³‡è¨Šè¨ˆç®—æ­£ç¢º (å¹³å‡ã€æœ€å°ã€æœ€å¤§)
- [ ] **æª”æ¡ˆä¸Šå‚³**: é©—è­‰æª”æ¡ˆè·¯å¾‘æ­£ç¢ºè¨˜éŒ„

### æ¡è³¼å–®æ¨¡çµ„æ¸¬è©¦ (Module 4)
- [ ] **å‰µå»º PO**: é©—è­‰æ˜ç´°è‡³å°‘ä¸€å€‹å“é …
- [ ] **æ›´æ–° PO**: é©—è­‰æ˜ç´°æ–°å¢ã€æ›´æ–°ã€åˆªé™¤
- [ ] **ç¸½é‡‘é¡è¨ˆç®—**: é©—è­‰è‡ªå‹•å¾æ˜ç´°ç´¯åŠ 
- [ ] **ç‹€æ…‹å·¥ä½œæµ**: Draft â†’ Submitted â†’ Approved
- [ ] **æ‰¹å‡†æ¬Šé™**: åƒ… Supervisor å¯æ‰¹å‡†
- [ ] **åˆªé™¤æª¢æŸ¥**: æœ‰é—œè¯ Expense å‰‡ä¸èƒ½åˆªé™¤
- [ ] **Transaction**: é©—è­‰è³‡æ–™ä¸€è‡´æ€§

### æ”¯å‡ºç®¡ç†æ¨¡çµ„æ¸¬è©¦ (Module 5)
- [ ] **å‰µå»º Expense**: é©—è­‰æ˜ç´°è‡³å°‘ä¸€å€‹é …ç›®
- [ ] **æ›´æ–° Expense**: é©—è­‰æ˜ç´°æ–°å¢ã€æ›´æ–°ã€åˆªé™¤
- [ ] **ç¸½é‡‘é¡è¨ˆç®—**: é©—è­‰è‡ªå‹•å¾æ˜ç´°ç´¯åŠ 
- [ ] **ç‹€æ…‹å·¥ä½œæµ**: Draft â†’ Submitted â†’ Approved â†’ Paid
- [ ] **æ‰¹å‡†é‚è¼¯**: é©—è­‰å¾ BudgetPool å’Œ BudgetCategory æ‰£æ¬¾
- [ ] **é ç®—æª¢æŸ¥**: æ‰¹å‡†å‰é©—è­‰é ç®—æ± é¤˜é¡
- [ ] **æ‹’çµ•é‚è¼¯**: é©—è­‰ç‹€æ…‹å›åˆ° Draft
- [ ] **é€šçŸ¥ç™¼é€**: æäº¤ã€æ‰¹å‡†ã€æ‹’çµ•æ™‚ç™¼é€é€šçŸ¥ (Epic 8)
- [ ] **Transaction**: é©—è­‰è³‡æ–™ä¸€è‡´æ€§

### è·¨æ¨¡çµ„æ•´åˆæ¸¬è©¦
- [ ] **Quote â†’ PO**: é©—è­‰å¾ Quote å‰µå»º PO çš„æµç¨‹
- [ ] **PO â†’ Expense**: é©—è­‰å¾ PO å‰µå»º Expense çš„æµç¨‹
- [ ] **é ç®—è¿½è¹¤**: é©—è­‰ Expense æ‰¹å‡†å¾Œé ç®—æ± æ­£ç¢ºæ‰£æ¬¾

---

## â­ï¸ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **ä¿®å¾© P2 å•é¡Œ**: ä¿®å¾© Expense API çš„ include æ¬„ä½éŒ¯èª¤
2. **ç¹¼çºŒå¯©æŸ¥è²»ç”¨è½‰å«**: æœ€å¾Œä¸€å€‹æ¨¡çµ„
3. **çµ±ä¸€ä¿®å¾©æ‰€æœ‰å•é¡Œ**: å»ºç«‹å®Œæ•´çš„å•é¡Œæ¸…å–®å¾Œçµ±ä¸€ä¿®å¾©
4. **æ‰‹å‹•æ¸¬è©¦**: å®Œæˆæ‰€æœ‰æ¨¡çµ„å¯©æŸ¥å¾Œ,é€²è¡Œæ‰‹å‹•æ¸¬è©¦

---

**æ¸¬è©¦äººå“¡**: AI åŠ©æ‰‹
**æœ€å¾Œæ›´æ–°**: 2025-11-11
**ç‹€æ…‹**: âœ… ç¨‹å¼ç¢¼å¯©æŸ¥ 100% å®Œæˆ,è­˜åˆ¥ 2 å€‹ P2 å•é¡Œ
