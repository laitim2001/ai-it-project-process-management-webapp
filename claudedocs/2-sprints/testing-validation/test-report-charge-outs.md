# æ¸¬è©¦å ±å‘Š: è²»ç”¨è½‰å«æ¨¡çµ„ (Charge-Outs Module)

> **æ¸¬è©¦æ—¥æœŸ**: 2025-11-11
> **æ¸¬è©¦äººå“¡**: AI åŠ©æ‰‹
> **æ¸¬è©¦ç’°å¢ƒ**: http://localhost:3001 (é–‹ç™¼ç’°å¢ƒ)
> **æ¸¬è©¦ç¯„åœ**: ChargeOut æ¨¡çµ„ç¨‹å¼ç¢¼å¯©æŸ¥

---

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦

### æ¸¬è©¦é é¢
- `/charge-outs` - è²»ç”¨è½‰å«åˆ—è¡¨é 
- `/charge-outs/new` - å‰µå»ºæ–°è²»ç”¨è½‰å«
- `/charge-outs/[id]` - è²»ç”¨è½‰å«è©³æƒ…é 

### æ¸¬è©¦ç‹€æ…‹
- âœ… ç¨‹å¼ç¢¼å¯©æŸ¥: å·²å®Œæˆ
- â³ æ‰‹å‹•æ¸¬è©¦: å¾…åŸ·è¡Œ

---

## ğŸ” ç¨‹å¼ç¢¼å¯©æŸ¥ç™¼ç¾

### 1. âœ… è²»ç”¨è½‰å«æ¨¡çµ„ (`chargeOut.ts` - 882 è¡Œ)

**API è·¯ç”±** (11 å€‹):
1. `create` - å‰µå»ºè²»ç”¨è½‰å« (è¡¨é ­ + æ˜ç´°)
2. `update` - æ›´æ–°åŸºæœ¬è³‡è¨Š
3. `updateItems` - æ‰¹é‡æ›´æ–°æ˜ç´°
4. `submit` - æäº¤å¯©æ ¸ (Draft â†’ Submitted)
5. `confirm` - ç¢ºèªè²»ç”¨è½‰å« (Submitted â†’ Confirmed, supervisorProcedure)
6. `reject` - æ‹’çµ•è²»ç”¨è½‰å« (Submitted â†’ Rejected)
7. `markAsPaid` - æ¨™è¨˜ç‚ºå·²æ”¯ä»˜ (Confirmed â†’ Paid)
8. `getById` - ç²å–è©³æƒ…
9. `getAll` - åˆ—è¡¨æŸ¥è©¢ (åˆ†é ã€ç‹€æ…‹/OpCo/é …ç›®ç¯©é¸)
10. `delete` - åˆªé™¤ (åƒ… Draft æˆ– Rejected å¯åˆªé™¤)
11. `getEligibleExpenses` - ç²å–å¯ç”¨æ–¼ ChargeOut çš„è²»ç”¨

**å„ªé»**:
- âœ… **è¡¨é ­-æ˜ç´°çµæ§‹**: ChargeOut + ChargeOutItem å®Œæ•´å¯¦ç¾
- âœ… **Transaction ä¿è­‰**: ä½¿ç”¨ `$transaction` ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- âœ… **ç‹€æ…‹å·¥ä½œæµ**: Draft â†’ Submitted â†’ Confirmed â†’ Paid / Rejected
- âœ… **æ¬Šé™æ§åˆ¶**: confirm å’Œ reject ä½¿ç”¨ supervisorProcedure
- âœ… **æ¥­å‹™é‚è¼¯é©—è­‰**: åªæœ‰ requiresChargeOut = true çš„è²»ç”¨å¯ä»¥è¢«è½‰å«
- âœ… **æ˜ç´°ç®¡ç†**: æ”¯æŒæ˜ç´°çš„æ–°å¢ã€æ›´æ–°ã€åˆªé™¤ (æ¨™è¨˜åˆªé™¤)
- âœ… **è‡ªå‹•è¨ˆç®—**: ç¸½é‡‘é¡è‡ªå‹•å¾æ˜ç´°ç´¯åŠ 
- âœ… **å®Œæ•´ include**: project, opCo, confirmer, items, expense, purchaseOrder, vendor

**ChargeOutItem Schema**:
```typescript
{
  expenseId, amount, description, sortOrder, _delete (æ¨™è¨˜åˆªé™¤)
}
```

**ç‹€æ…‹æµç¨‹**:
```
Draft â†’ Submitted â†’ Confirmed â†’ Paid
                  â†’ Rejected
```

**æ¥­å‹™è¦å‰‡**:
- åªæœ‰ Draft ç‹€æ…‹å¯ä»¥æ›´æ–°åŸºæœ¬è³‡è¨Šå’Œæ˜ç´°
- åªæœ‰ Submitted ç‹€æ…‹å¯ä»¥ç¢ºèªæˆ–æ‹’çµ•
- åªæœ‰ Confirmed ç‹€æ…‹å¯ä»¥æ¨™è¨˜ç‚ºå·²æ”¯ä»˜
- åªæœ‰ Draft æˆ– Rejected ç‹€æ…‹å¯ä»¥åˆªé™¤
- è²»ç”¨å¿…é ˆæ¨™è¨˜ requiresChargeOut = true ä¸”ç‹€æ…‹ç‚º Approved æˆ– Paid

---

## ğŸ› å·²è­˜åˆ¥å•é¡Œ

### âš ï¸ ç„¡å•é¡Œç™¼ç¾

ç¶“éå®Œæ•´çš„ç¨‹å¼ç¢¼å¯©æŸ¥,**æœªç™¼ç¾ä»»ä½•å•é¡Œ**ã€‚è²»ç”¨è½‰å«æ¨¡çµ„çš„å¯¦ä½œéå¸¸å®Œå–„:
- âœ… ç„¡ä½¿ç”¨ deprecated æ¬„ä½
- âœ… å®Œæ•´çš„ç‹€æ…‹æ©Ÿé©—è­‰
- âœ… Transaction ä¿è­‰è³‡æ–™ä¸€è‡´æ€§
- âœ… å®Œæ•´çš„æ¥­å‹™é‚è¼¯é©—è­‰
- âœ… æ¬Šé™æ§åˆ¶å®Œæ•´å¯¦ç¾

---

## ğŸ“Š å¯©æŸ¥çµ±è¨ˆ

### å®Œæˆåº¦
- **ç¨‹å¼ç¢¼å¯©æŸ¥**: 100% (882 è¡Œ)
- **API å¯©æŸ¥**: 100% (11 å€‹ API ç«¯é»å…¨éƒ¨å¯©æŸ¥)

### å•é¡Œçµ±è¨ˆ
- **ğŸ”´ P0 Critical**: 0 å€‹
- **ğŸŸ  P1 High**: 0 å€‹
- **ğŸŸ¡ P2 Medium**: 0 å€‹
- **ğŸŸ¢ P3 Low**: 0 å€‹

---

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
- [ ] **å‰µå»º ChargeOut**: é©—è­‰æ˜ç´°è‡³å°‘ä¸€å€‹é …ç›®
- [ ] **æ›´æ–° ChargeOut**: é©—è­‰åƒ… Draft ç‹€æ…‹å¯æ›´æ–°
- [ ] **æ›´æ–°æ˜ç´°**: é©—è­‰æ˜ç´°æ–°å¢ã€æ›´æ–°ã€åˆªé™¤
- [ ] **ç¸½é‡‘é¡è¨ˆç®—**: é©—è­‰è‡ªå‹•å¾æ˜ç´°ç´¯åŠ 
- [ ] **åˆªé™¤ ChargeOut**: åƒ… Draft æˆ– Rejected å¯åˆªé™¤

### ç‹€æ…‹å·¥ä½œæµæ¸¬è©¦
- [ ] **æäº¤å¯©æ ¸**: Draft â†’ Submitted (é©—è­‰è‡³å°‘ä¸€å€‹é …ç›®)
- [ ] **ç¢ºèª ChargeOut**: Submitted â†’ Confirmed (supervisorProcedure)
- [ ] **æ‹’çµ• ChargeOut**: Submitted â†’ Rejected (è¨˜éŒ„æ‹’çµ•åŸå› )
- [ ] **æ¨™è¨˜å·²æ”¯ä»˜**: Confirmed â†’ Paid (è¨˜éŒ„æ”¯ä»˜æ—¥æœŸ)

### æ¥­å‹™é‚è¼¯æ¸¬è©¦
- [ ] **è²»ç”¨è³‡æ ¼é©—è­‰**: åªæœ‰ requiresChargeOut = true çš„è²»ç”¨å¯è¢«é¸æ“‡
- [ ] **è²»ç”¨ç‹€æ…‹é©—è­‰**: åªæœ‰ Approved æˆ– Paid çš„è²»ç”¨å¯è¢«é¸æ“‡
- [ ] **OpCo é©—è­‰**: é©—è­‰ OpCo å­˜åœ¨æ€§
- [ ] **Project é©—è­‰**: é©—è­‰ Project å­˜åœ¨æ€§

### æ¬Šé™æ¸¬è©¦
- [ ] **ç¢ºèªæ¬Šé™**: åƒ… Supervisor å¯ç¢ºèª (supervisorProcedure)
- [ ] **æ‹’çµ•æ¬Šé™**: åƒ… Supervisor å¯æ‹’çµ• (supervisorProcedure)
- [ ] **å…¶ä»–æ“ä½œ**: é©—è­‰ protectedProcedure ä¿è­·

### æŸ¥è©¢åŠŸèƒ½æ¸¬è©¦
- [ ] **åˆ—è¡¨æŸ¥è©¢**: é©—è­‰åˆ†é ã€ç‹€æ…‹ç¯©é¸ã€OpCo ç¯©é¸ã€Project ç¯©é¸
- [ ] **è©³æƒ…æŸ¥è©¢**: é©—è­‰å®Œæ•´ include (project, opCo, confirmer, items, expense, vendor)
- [ ] **å¯ç”¨è²»ç”¨æŸ¥è©¢**: é©—è­‰ getEligibleExpenses æ­£ç¢ºç¯©é¸

### Transaction æ¸¬è©¦
- [ ] **å‰µå»º Transaction**: é©—è­‰è¡¨é ­å’Œæ˜ç´°åŒæ™‚å‰µå»º
- [ ] **æ›´æ–° Transaction**: é©—è­‰æ˜ç´°æ›´æ–°å’Œç¸½é‡‘é¡é‡ç®—
- [ ] **éŒ¯èª¤å›æ»¾**: é©—è­‰ Transaction å¤±æ•—æ™‚å›æ»¾

### éŒ¯èª¤è™•ç†æ¸¬è©¦
- [ ] **ChargeOut ä¸å­˜åœ¨**: 404 éŒ¯èª¤
- [ ] **ç„¡æ•ˆç‹€æ…‹æ“ä½œ**: 400 éŒ¯èª¤
- [ ] **æ¬Šé™ä¸è¶³**: 403 éŒ¯èª¤
- [ ] **è²»ç”¨ä¸ç¬¦åˆè³‡æ ¼**: 400 éŒ¯èª¤

---

## â­ï¸ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **å»ºç«‹å®Œæ•´å•é¡Œæ¸…å–®**: åŒ¯ç¸½æ‰€æœ‰æ¨¡çµ„çš„å•é¡Œ
2. **çµ±ä¸€ä¿®å¾©æ‰€æœ‰å•é¡Œ**: å»ºç«‹å®Œæ•´çš„å•é¡Œæ¸…å–®å¾Œçµ±ä¸€ä¿®å¾©
3. **æ‰‹å‹•æ¸¬è©¦**: å®Œæˆæ‰€æœ‰æ¨¡çµ„å¯©æŸ¥å¾Œ,é€²è¡Œæ‰‹å‹•æ¸¬è©¦

---

**æ¸¬è©¦äººå“¡**: AI åŠ©æ‰‹
**æœ€å¾Œæ›´æ–°**: 2025-11-11
**ç‹€æ…‹**: âœ… ç¨‹å¼ç¢¼å¯©æŸ¥ 100% å®Œæˆ,ç„¡å•é¡Œç™¼ç¾
