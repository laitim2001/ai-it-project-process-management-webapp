# CHANGE-004: OM Summary è¡¨é ­-æ˜ç´°éšå±¤é¡¯ç¤º

## è®Šæ›´æ¦‚è¿°

| é …ç›® | å…§å®¹ |
|------|------|
| **è®Šæ›´ç·¨è™Ÿ** | CHANGE-004 |
| **è®Šæ›´åç¨±** | OM Summary è¡¨é ­-æ˜ç´°éšå±¤é¡¯ç¤º |
| **å½±éŸ¿ç¯„åœ** | OMSummaryDetailGrid, omExpense.getSummary API |
| **å„ªå…ˆç´š** | ä¸­ |
| **ç‹€æ…‹** | âœ… å·²å®Œæˆ |
| **é–‹å§‹æ—¥æœŸ** | 2025-12-05 |
| **é—œè¯åŠŸèƒ½** | FEAT-007 (OM Expense è¡¨é ­-æ˜ç´°æ¶æ§‹é‡æ§‹) |

## å•é¡ŒèƒŒæ™¯

### ç¾ç‹€å•é¡Œ

FEAT-007 å·²å®Œæˆ OM Expense è¡¨é ­-æ˜ç´°æ¶æ§‹é‡æ§‹ï¼Œä½† OM Summary é é¢çš„æ˜ç´°åˆ—è¡¨å°šæœªæ›´æ–°ä»¥åæ˜ æ–°æ¶æ§‹ï¼š

**ç•¶å‰çµæ§‹**:
```
Category (é¡åˆ¥)
  â””â”€â”€ OpCo Group (ç‡Ÿé‹å…¬å¸)
        â””â”€â”€ Items (æ‰å¹³åŒ–é …ç›®åˆ—è¡¨)
              â”œâ”€â”€ Item 1
              â”œâ”€â”€ Item 2
              â””â”€â”€ Item 3
```

**å•é¡Œ**:
1. ç„¡æ³•è­˜åˆ¥å“ªäº›é …ç›®å±¬æ–¼åŒä¸€å€‹ OM Expense è¡¨é ­
2. ä½¿ç”¨è€…ç„¡æ³•å¿«é€Ÿç†è§£è²»ç”¨çš„éšå±¤é—œä¿‚
3. èˆ‡ FEAT-007 æ–°æ¶æ§‹ä¸ä¸€è‡´
4. å½±éŸ¿ä½¿ç”¨è€…å°è²»ç”¨çµæ§‹çš„ç†è§£

### æœŸæœ›çµæ§‹

æ ¹æ“šä½¿ç”¨è€…éœ€æ±‚ï¼ˆæˆªåœ–ï¼‰ï¼ŒæœŸæœ›é¡¯ç¤ºä»¥ä¸‹éšå±¤ï¼š

```
Category (é¡åˆ¥): è»Ÿé«”
  â””â”€â”€ OpCo Group (ç‡Ÿé‹å…¬å¸): RHK - RHK
        â””â”€â”€ OM Expense Header (è¡¨é ­è¨˜éŒ„): testing - Chris Lai - 20250901222
              â”œâ”€â”€ OMExpenseItem 1 (æ˜ç´°)
              â”œâ”€â”€ OMExpenseItem 2 (æ˜ç´°)
              â””â”€â”€ ...
        â””â”€â”€ OM Expense Header (å¦ä¸€è¡¨é ­)
              â””â”€â”€ ...
```

## è§£æ±ºæ–¹æ¡ˆ

### éšå±¤æ¶æ§‹è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OMSummaryDetailGrid é¡¯ç¤ºçµæ§‹                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Accordion: Category (é¡åˆ¥)                                      â”‚
â”‚    â””â”€â”€ Accordion: OpCo Group (ç‡Ÿé‹å…¬å¸)                          â”‚
â”‚          â””â”€â”€ ã€æ–°å¢ã€‘Accordion: OMExpense Header (è¡¨é ­)           â”‚
â”‚                â”œâ”€â”€ è¡¨é ­è³‡è¨Š: name, description, å»ºç«‹è€…ç­‰          â”‚
â”‚                â””â”€â”€ Table: OMExpenseItems (æ˜ç´°åˆ—è¡¨)               â”‚
â”‚                      â”œâ”€â”€ Item row 1                              â”‚
â”‚                      â””â”€â”€ Item row 2                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™çµæ§‹è®Šæ›´

**ç•¶å‰ API è¿”å›çµæ§‹**:
```typescript
interface CategoryDetailGroup {
  category: string;
  opCoGroups: OpCoGroup[];
}

interface OpCoGroup {
  opCoId: string;
  items: ItemDetail[];  // æ‰å¹³åŒ–é …ç›®
}
```

**æ–° API è¿”å›çµæ§‹**:
```typescript
interface CategoryDetailGroup {
  category: string;
  opCoGroups: OpCoGroup[];
}

interface OpCoGroup {
  opCoId: string;
  opCoCode: string;
  opCoName: string;
  omExpenseHeaders: OMExpenseHeaderGroup[];  // ã€æ–°å¢ã€‘æŒ‰è¡¨é ­åˆ†çµ„
  subTotal: OpCoSubTotal;
}

// ã€æ–°å¢ã€‘OM Expense è¡¨é ­åˆ†çµ„
interface OMExpenseHeaderGroup {
  omExpenseId: string;
  omExpenseName: string;
  omExpenseDescription: string | null;
  createdBy: string;
  createdAt: Date;
  items: ItemDetail[];
  headerTotal: {
    currentYearBudget: number;
    previousYearActual: number;
    changePercent: number | null;
  };
}
```

## å¯¦æ–½è¨ˆåŠƒ

### Phase 1: API æ›´æ–° (é ä¼° 2-3h)
- [ ] ä¿®æ”¹ `omExpense.getSummary` API
- [ ] æ–°å¢ `OMExpenseHeaderGroup` é¡å‹å®šç¾©
- [ ] æ›´æ–°æŸ¥è©¢é‚è¼¯ï¼ŒæŒ‰ OMExpense è¡¨é ­åˆ†çµ„
- [ ] ä¿æŒå‘å¾Œå…¼å®¹æ€§ï¼ˆæ”¯æ´èˆŠè³‡æ–™ï¼‰

### Phase 2: å‰ç«¯çµ„ä»¶æ›´æ–° (é ä¼° 3-4h)
- [ ] æ–°å¢ `OMExpenseHeaderGroup` ä»‹é¢å®šç¾©
- [ ] åœ¨ `OMSummaryDetailGrid` æ–°å¢è¡¨é ­å±¤ Accordion
- [ ] æ›´æ–° `ItemTable` ä»¥æ”¯æ´æ–°çµæ§‹
- [ ] èª¿æ•´æ¨£å¼å’Œç¸®æ’å±¤ç´š
- [ ] æ›´æ–°è¡¨é ­/å°è¨ˆé¡¯ç¤ºé‚è¼¯

### Phase 3: I18N æ›´æ–° (é ä¼° 0.5h)
- [ ] æ–°å¢è¡¨é ­ç›¸é—œç¿»è­¯éµ
- [ ] æ›´æ–° `zh-TW.json` å’Œ `en.json`

### Phase 4: æ¸¬è©¦é©—è­‰ (é ä¼° 1-2h)
- [ ] TypeScript é¡å‹æª¢æŸ¥
- [ ] ESLint æª¢æŸ¥
- [ ] åŠŸèƒ½æ¸¬è©¦ï¼ˆå¤šå±¤ç´šå±•é–‹/æ”¶åˆï¼‰
- [ ] å‘å¾Œå…¼å®¹æ€§æ¸¬è©¦ï¼ˆèˆŠæ¶æ§‹è³‡æ–™ï¼‰
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆæ¸¬è©¦

**ç¸½é ä¼°æ™‚é–“**: 6.5-9.5 å°æ™‚

## ä¿®æ”¹æ–‡ä»¶æ¸…å–®

### API (packages/api/)
| æ–‡ä»¶ | è®Šæ›´é¡å‹ | èªªæ˜ |
|------|----------|------|
| `src/routers/omExpense.ts` | ä¿®æ”¹ | æ›´æ–° getSummary è¿”å›çµæ§‹ |

### å‰ç«¯çµ„ä»¶ (apps/web/)
| æ–‡ä»¶ | è®Šæ›´é¡å‹ | èªªæ˜ |
|------|----------|------|
| `src/components/om-summary/OMSummaryDetailGrid.tsx` | ä¿®æ”¹ | æ–°å¢è¡¨é ­å±¤çµæ§‹ |

### I18N (apps/web/)
| æ–‡ä»¶ | è®Šæ›´é¡å‹ | èªªæ˜ |
|------|----------|------|
| `src/messages/zh-TW.json` | ä¿®æ”¹ | æ–°å¢è¡¨é ­ç›¸é—œç¿»è­¯ |
| `src/messages/en.json` | ä¿®æ”¹ | æ–°å¢è¡¨é ­ç›¸é—œç¿»è­¯ |

## UI è¨­è¨ˆ

### æ˜ç´°åˆ—è¡¨çµæ§‹ç¤ºæ„

```
æ˜ç´°åˆ—è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ é¡åˆ¥: è»Ÿé«”                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ğŸ¢ RHK - RHK                                                   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚ ğŸ“‹ OM Expense: testing - Chris Lai - 20250901222            â”‚
â”‚   â”‚     # | é …ç›®        | FY25é ç®—  | FY24å¯¦éš› | è®Šå‹•% | ç¶­è­·åˆ°æœŸæ—¥ â”‚
â”‚   â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚   â”‚     1 | æ˜ç´°é …ç›® 1  | $27,345   | $0       | -     | 12/11/2025â”‚
â”‚   â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚   â”‚       | å°è¨ˆ        | $27,345   | $0       | -     |          â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚       | OpCo å°è¨ˆ   | $27,345   | $0       | -     |          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         | é¡åˆ¥ç¸½è¨ˆ     | $27,345   | $0       | -     |          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¢ UI å…ƒç´ 

1. **OM Expense è¡¨é ­è¡Œ**
   - ğŸ“‹ åœ–æ¨™æ¨™è­˜
   - è¡¨é ­åç¨± + æè¿°ï¼ˆå¯é¸ï¼‰
   - å¯å±•é–‹/æ”¶åˆ

2. **å±¤ç´šæ¨£å¼å€åˆ†**
   - Category: `bg-muted/50` (è¼ƒæ·±èƒŒæ™¯)
   - OpCo: `bg-muted/30` (ä¸­ç­‰èƒŒæ™¯)
   - OMExpense Header: `bg-muted/10` (æ·ºèƒŒæ™¯)
   - Items: ç™½è‰²/é€æ˜èƒŒæ™¯

3. **ç¸®æ’å±¤ç´š**
   - Category: 0 indent
   - OpCo: 1 level indent
   - OMExpense: 2 level indent
   - Items: 3 level indent

## å‘å¾Œå…¼å®¹æ€§

1. **èˆŠæ¶æ§‹è³‡æ–™è™•ç†**
   - å°æ–¼æ²’æœ‰ OMExpenseItem çš„èˆŠ OMExpense è¨˜éŒ„
   - å°‡å…¶è¦–ç‚ºã€Œå–®é …ç›®è¡¨é ­ã€é¡¯ç¤º
   - ä¸æœƒé€ æˆè³‡æ–™éºå¤±æˆ–é¡¯ç¤ºéŒ¯èª¤

2. **API ç‰ˆæœ¬æ§åˆ¶**
   - ä¿æŒç¾æœ‰ API çµæ§‹å¯ç”¨
   - æ–°å¢æ¬„ä½ç‚ºå¯é¸ï¼ˆoptionalï¼‰
   - å‰ç«¯é€²è¡Œå‘å¾Œå…¼å®¹è™•ç†

## é¢¨éšªè©•ä¼°

| é¢¨éšª | ç­‰ç´š | ç·©è§£æªæ–½ |
|------|------|----------|
| API çµæ§‹è®Šæ›´å°è‡´å‰ç«¯éŒ¯èª¤ | ä¸­ | æ¼¸é€²å¼æ›´æ–°ï¼Œä¿æŒå‘å¾Œå…¼å®¹ |
| è¤‡é›œå·¢ç‹€å°è‡´æ€§èƒ½å•é¡Œ | ä½ | ä½¿ç”¨è™›æ“¬åŒ–æˆ–åˆ†é ï¼ˆå¦‚éœ€è¦ï¼‰ |
| UI å±¤ç´šéå¤šå°è‡´é›£ä»¥é–±è®€ | ä½ | è¨­è¨ˆæ¸…æ™°çš„è¦–è¦ºå±¤ç´šå€åˆ† |
| I18N ç¿»è­¯ç¼ºå¤± | ä½ | ä½¿ç”¨ defaultValue ä½œç‚ºå›é€€ |

## é–‹ç™¼è¨˜éŒ„

### 2025-12-05
- å»ºç«‹ CHANGE-004 æ–‡æª”
- ç¢ºèªç‚º SITUATION-3ï¼ˆåŠŸèƒ½å¢å¼·ï¼‰è€Œéæ–°åŠŸèƒ½
- å®Œæˆè¨­è¨ˆå’Œå¯¦æ–½è¨ˆåŠƒ

### 2025-12-05 (å¯¦æ–½å®Œæˆ)
- âœ… Phase 1: API æ›´æ–°å®Œæˆ
  - æ–°å¢ `OMExpenseHeaderGroup` é¡å‹
  - æ›´æ–° `OpCoGroup` ä»‹é¢åŒ…å« `omExpenseHeaders`
  - æ›´æ–° `getSummary` æŸ¥è©¢æ”¯æ´ items é—œè¯
  - é‡æ§‹åˆ†çµ„é‚è¼¯æ”¯æ´æ–°æ¶æ§‹
  - ä¿æŒå‘å¾Œå…¼å®¹ï¼ˆèˆŠæ¶æ§‹è³‡æ–™ä»å¯é¡¯ç¤ºï¼‰
- âœ… Phase 2: å‰ç«¯çµ„ä»¶æ›´æ–°å®Œæˆ
  - æ–°å¢ `OMExpenseHeaderGroup` å’Œæ›´æ–° `OpCoGroup` é¡å‹å®šç¾©
  - æ–°å¢ `OMExpenseHeaderSection` çµ„ä»¶
  - æ”¯æ´ Category â†’ OpCo â†’ OMExpense Header â†’ Items å››å±¤éšå±¤
  - è¡¨é ­å±¤ä½¿ç”¨è—è‰²ä¸»é¡Œå€åˆ†
  - æ”¯æ´é»æ“Šå°èˆªåŠŸèƒ½
- âœ… Phase 3: I18N æ›´æ–°å®Œæˆ
  - æ–°å¢ `headerTotal` (è¡¨é ­ç¸½è¨ˆ)
  - æ–°å¢ `headerSubTotal` (è¡¨é ­å°è¨ˆ)
- âœ… Phase 4: é©—è­‰å®Œæˆ
  - TypeScript é¡å‹æª¢æŸ¥ï¼šç„¡éŒ¯èª¤
  - I18N é©—è­‰ï¼š2081 å€‹éµï¼Œçµæ§‹ä¸€è‡´

---

**è² è²¬äºº**: AI Assistant
**å¯©æ ¸äºº**: å¾…å®š
**æœ€å¾Œæ›´æ–°**: 2025-12-05
