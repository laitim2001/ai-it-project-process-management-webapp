# 2025-W47 每週進度 (11月17日 - 11月23日)

## 本週目標
- ✅ 完成 FEAT-001 專案欄位擴展 Phase 1-4
- ⏳ 開始 FEAT-001 Phase 5 - 專案列表頁面進階功能

## 完成情況

### 已完成 ✅

#### FEAT-001 Phase 1-4 完整實現
**日期**: 2025-11-16 - 2025-11-17

1. **Phase 1: 資料庫與後端** ✅
   - 創建 Currency Model (ISO 4217 標準)
   - 更新 Project Model (4 個新欄位)
   - 創建 Migration 並 Seed 預設貨幣
   - Currency API Router (完整 CRUD)
   - Project API Router 更新

2. **Phase 2: 前端表單** ✅
   - ProjectForm 組件更新 (4 個新欄位)
   - 專案編號即時唯一性驗證 (debounce 500ms)
   - 全域標誌 Select (RCL/Region)
   - 優先權 Select (High/Medium/Low)
   - 貨幣 Combobox (可搜尋)

3. **Phase 3: 列表與詳情頁** ✅
   - 專案列表新增 3 個欄位顯示
   - Badge 組件視覺化狀態
   - 專案詳情頁新增 4 個欄位
   - Currency include 關聯查詢

4. **Phase 4: 貨幣管理頁面 UI** ✅
   - 貨幣管理頁面 (`/settings/currencies`)
   - 完整 CRUD 功能 (新增、編輯、啟用/停用)
   - 顯示貨幣使用統計
   - I18N 支援 (42 個新鍵)
   - 側邊欄導航整合

5. **Bug 修復** ✅
   - 修正 i18n 翻譯鍵缺失問題 (3 個修復)
   - 修正 priority 欄位翻譯路徑錯誤
   - 修正 useToast import 路徑

### 進行中 ⏳

#### FEAT-001 Phase 5: 專案列表頁面進階功能
**狀態**: 部分完成 (50%)
**開始時間**: 2025-11-17

**已完成部分**:
1. ✅ API Router 更新
   - 新增篩選參數: projectCode, globalFlag, priority, currencyId
   - 更新搜尋邏輯: 支持專案編號搜尋 (OR 條件)
   - 更新排序選項: 支持 projectCode 和 priority 排序

2. ✅ 前端 State 更新
   - 添加新的篩選器 state: globalFlagFilter, priorityFilter, currencyFilter
   - 更新 sortBy 類型支持新欄位

**待完成部分**:
3. ⏸️ 前端 UI 更新
   - 在頁面添加新的篩選器 UI
   - 更新排序選項下拉選單
   - 添加 i18n 翻譯鍵
   - 查詢啟用的貨幣列表

4. ⏸️ 測試
   - 測試所有篩選器功能
   - 測試專案編號搜尋
   - 測試新的排序選項

### 未開始 ⏸️

#### Phase 6: 完整手動測試
- 建立專案完整流程測試
- 編輯專案流程測試
- 貨幣管理流程測試

## 代碼變更統計

### 本週提交記錄
```
13165d7 - feat(nav): 在側邊欄添加貨幣管理入口
7ea3de2 - fix(currencies): 修正 useToast import 路徑
09719fc - feat(currencies): FEAT-001 Phase 4 - 貨幣管理頁面 UI 完成
155cb5e - fix(projects): 修正詳情頁面 priority 欄位翻譯路徑錯誤
37840d9 - fix(i18n): 修正專案詳情頁面的翻譯鍵缺失問題
b2b780b - fix(api): FEAT-001 修正 create procedure TypeScript 錯誤
0c4b59c - feat(projects): FEAT-001 Phase 3 - 列表與詳情頁面開發完成
9cb0c86 - feat(projects): FEAT-001 Phase 2 - 前端表單開發完成
167a03f - feat(FEAT-001): Phase 1 完成 - 資料庫與後端開發
```

### 文件變更
- **新增文件**: 2 個
  - `apps/web/src/app/[locale]/settings/currencies/page.tsx` (470 行)
  - `claudedocs/3-progress/weekly/2025-W47.md`

- **修改文件**: 10+ 個
  - `packages/db/prisma/schema.prisma` (Currency Model)
  - `packages/api/src/routers/currency.ts` (新增)
  - `packages/api/src/routers/project.ts` (Phase 1 & Phase 5 更新)
  - `apps/web/src/components/project/ProjectForm.tsx`
  - `apps/web/src/app/[locale]/projects/[id]/page.tsx`
  - `apps/web/src/app/[locale]/projects/page.tsx` (Phase 5 部分)
  - `apps/web/src/components/layout/Sidebar.tsx`
  - `apps/web/src/messages/zh-TW.json` (+116 keys)
  - `apps/web/src/messages/en.json` (+116 keys)
  - `claudedocs/1-planning/features/FEAT-001-project-fields-enhancement/01-requirements.md`
  - `DEVELOPMENT-LOG.md`

### 代碼統計
- **新增行數**: ~2,500+ lines
- **I18N 鍵**: +116 keys (zh-TW + en)
- **新增組件**: 1 個 (CurrenciesPage)
- **新增 API Router**: 1 個 (currency.ts)
- **Commits**: 10 次

## 遇到的挑戰

### 挑戰 1: I18N 翻譯鍵路徑錯誤
- **問題**: 專案詳情頁面出現 `IntlError: MISSING_MESSAGE` 和 `INSUFFICIENT_PATH` 錯誤
- **原因**:
  1. 翻譯鍵在 `projects.fields.*` 但頁面期望 `projects.detail.fields.*`
  2. `priority` 是物件但直接當字串使用
- **解決方案**:
  1. 在 `projects.detail.fields.*` 下添加完整翻譯鍵
  2. 將 `t('fields.priority')` 改為 `t('fields.priority.label')`
- **學習**: next-intl 的命名空間作用域需要仔細規劃，避免鍵路徑不一致

### 挑戰 2: Toast Hook Import 路徑錯誤
- **問題**: Build Error - `Can't resolve '@/hooks/use-toast'`
- **原因**: 項目中 toast hook 在 `@/components/ui/use-toast`，不是 `@/hooks/`
- **解決方案**: 修正 import 路徑為 `@/components/ui/use-toast`
- **學習**: 新建頁面時需要確認項目的組件路徑約定

### 挑戰 3: Phase 5 API 支持不完整
- **問題**: 前端需要新的篩選器，但 API 還未支持
- **解決方案**:
  1. 先更新 API Router 添加篩選參數支持
  2. 更新搜尋邏輯支持 OR 條件（專案名稱 OR 專案編號）
  3. 更新前端 state 和 UI
- **學習**: 後端 API 先行，確保前端有完整支持

## 技術決策

### 決策 1: 搜尋邏輯增強
- **選項**:
  - A) 只搜尋專案名稱
  - B) 搜尋專案名稱 OR 專案編號
- **選擇**: B
- **理由**: 用戶可能記得專案編號而不是名稱，OR 條件提供更好的搜尋體驗

### 決策 2: 貨幣管理頁面位置
- **選項**:
  - A) 放在 `/settings` 主頁面
  - B) 獨立路由 `/settings/currencies`
  - C) 放在系統管理下 `/admin/currencies`
- **選擇**: B
- **理由**: 獨立路由清晰，側邊欄可直接訪問，符合設定子頁面的模式

### 決策 3: Phase 5 開發策略
- **選項**:
  - A) 一次性完成所有篩選器和 UI
  - B) 先完成後端 API，再完成前端 UI
- **選擇**: B
- **理由**: 後端先行確保 API 完整性，前端可以逐步測試每個篩選器

## 下週計劃

### 待完成任務
- [ ] 完成 FEAT-001 Phase 5 - 前端 UI 更新
  - [ ] 添加全域標誌篩選器 UI
  - [ ] 添加優先權篩選器 UI
  - [ ] 添加貨幣篩選器 UI
  - [ ] 更新排序選項下拉選單
  - [ ] 添加 i18n 翻譯鍵
  - [ ] 更新 API 查詢傳遞新參數

- [ ] 完成 FEAT-001 Phase 6 - 完整手動測試
  - [ ] 測試建立專案流程
  - [ ] 測試編輯專案流程
  - [ ] 測試貨幣管理功能
  - [ ] 測試列表頁面所有篩選器
  - [ ] 測試列表頁面所有排序選項

- [ ] FEAT-001 文檔完善
  - [ ] 更新 `01-requirements.md` 驗收標準
  - [ ] 更新 `04-progress.md` 開發進度
  - [ ] 更新 `DEVELOPMENT-LOG.md`

- [ ] 代碼品質優化
  - [ ] 修復剩餘 TypeScript 錯誤（如果有）
  - [ ] 修復 ESLint 警告（如果有）

## 風險提示
- ⚠️ **Phase 5 UI 複雜度** - 4 個新篩選器 + 排序更新，需要仔細測試所有組合
  - **緩解措施**: 逐個篩選器測試，確保每個獨立工作正常

- ⚠️ **I18N 鍵數量** - 已新增 116+ 鍵，需要確保所有鍵都正確使用
  - **緩解措施**: 每次修改後運行 `pnpm validate:i18n` 驗證

- ⚠️ **API 性能** - 多個篩選器組合可能影響查詢性能
  - **緩解措施**: 確保資料庫索引已建立（projectCode, globalFlag, priority, currencyId）

## 統計數據
- **代碼行數**: +2,500 / -50
- **文件變更**: 12 個新增/修改
- **Commits**: 10 次
- **工作時間**: ~6 小時
- **完成度**: FEAT-001 約 85% 完成

## 本週亮點
1. ✨ 完整實現貨幣管理系統（ISO 4217 標準）
2. ✨ 專案編號即時唯一性驗證體驗良好
3. ✨ I18N 支援完善（1857 keys，zh-TW + en 100% 一致）
4. ✨ 側邊欄導航整合順暢
5. ✨ 3 個 i18n bug 快速修復
