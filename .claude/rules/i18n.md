# I18N Rules - åœ‹éš›åŒ–è¦ç¯„

---
applies_to:
  - "apps/web/src/messages/**"
  - "apps/web/src/app/[locale]/**"
  - "apps/web/src/components/**"
---

## æ¦‚è¿°
æ­¤è¦å‰‡é©ç”¨æ–¼ next-intl åœ‹éš›åŒ–å¯¦ç¾ï¼Œæ”¯æ´è‹±æ–‡ï¼ˆenï¼‰å’Œç¹é«”ä¸­æ–‡ï¼ˆzh-TWï¼‰ã€‚

## æ ¸å¿ƒé…ç½®

### æ”¯æ´çš„èªè¨€
| Locale | èªè¨€ | ç¿»è­¯æª”æ¡ˆ |
|--------|------|----------|
| `en` | English | `apps/web/src/messages/en.json` |
| `zh-TW` | ç¹é«”ä¸­æ–‡ | `apps/web/src/messages/zh-TW.json` |

### Key å‘½åç´„å®š
```
namespace.category.subcategory.field.property
```

ç¯„ä¾‹ï¼š
- `projects.form.name.label` - å°ˆæ¡ˆè¡¨å–®åç¨±æ¬„ä½æ¨™ç±¤
- `common.actions.save` - é€šç”¨æ“ä½œå„²å­˜æŒ‰éˆ•
- `budgetPools.dialogs.delete.title` - é ç®—æ± åˆªé™¤å°è©±æ¡†æ¨™é¡Œ

## ä½¿ç”¨æ¨¡å¼

### å®¢æˆ¶ç«¯çµ„ä»¶
```typescript
'use client';
import { useTranslations } from 'next-intl';

export function MyComponent() {
  const t = useTranslations('projects');
  const tCommon = useTranslations('common');

  return (
    <div>
      <h1>{t('form.title')}</h1>
      <Button>{tCommon('actions.save')}</Button>
    </div>
  );
}
```

### ä¼ºæœå™¨çµ„ä»¶
```typescript
import { getTranslations } from 'next-intl/server';

export default async function Page() {
  const t = await getTranslations('projects');

  return <h1>{t('pageTitle')}</h1>;
}
```

### å¸¶åƒæ•¸çš„ç¿»è­¯
```typescript
// ç¿»è­¯æª”æ¡ˆ
{
  "welcome": "æ­¡è¿ï¼Œ{name}ï¼",
  "itemCount": "å…± {count} é …"
}

// ä½¿ç”¨
t('welcome', { name: 'John' })
t('itemCount', { count: 5 })
```

### è¤‡æ•¸å½¢å¼
```typescript
// ç¿»è­¯æª”æ¡ˆ
{
  "items": "{count, plural, =0 {æ²’æœ‰é …ç›®} =1 {1 å€‹é …ç›®} other {# å€‹é …ç›®}}"
}

// ä½¿ç”¨
t('items', { count: 0 })  // "æ²’æœ‰é …ç›®"
t('items', { count: 1 })  // "1 å€‹é …ç›®"
t('items', { count: 5 })  // "5 å€‹é …ç›®"
```

## ç¿»è­¯æª”æ¡ˆçµæ§‹

```json
{
  "common": {
    "actions": {
      "save": "å„²å­˜",
      "cancel": "å–æ¶ˆ",
      "delete": "åˆªé™¤",
      "edit": "ç·¨è¼¯",
      "create": "æ–°å¢"
    },
    "status": {
      "loading": "è¼‰å…¥ä¸­...",
      "error": "ç™¼ç”ŸéŒ¯èª¤"
    }
  },
  "projects": {
    "pageTitle": "å°ˆæ¡ˆç®¡ç†",
    "form": {
      "name": {
        "label": "å°ˆæ¡ˆåç¨±",
        "placeholder": "è«‹è¼¸å…¥å°ˆæ¡ˆåç¨±"
      }
    },
    "dialogs": {
      "delete": {
        "title": "ç¢ºèªåˆªé™¤",
        "description": "ç¢ºå®šè¦åˆªé™¤æ­¤å°ˆæ¡ˆå—ï¼Ÿ"
      }
    }
  }
}
```

## ğŸš¨ å¸¸è¦‹å•é¡Œèˆ‡æœ€ä½³å¯¦è¸

### å•é¡Œ 1ï¼šé‡è¤‡ Keyï¼ˆé—œéµï¼ï¼‰
JSON ä¸å…è¨±é‡è¤‡ keyï¼Œå¾Œè€…æœƒè¦†è“‹å‰è€…ï¼š
```json
// âŒ éŒ¯èª¤ï¼šå…©å€‹ "form" æœƒå°è‡´ç¬¬ä¸€å€‹è¢«è¦†è“‹
{
  "projects": {
    "form": { "name": "..." },
    "form": { "status": "..." }
  }
}

// âœ… æ­£ç¢ºï¼šåˆä½µåˆ°åŒä¸€å€‹ "form"
{
  "projects": {
    "form": {
      "name": "...",
      "status": "..."
    }
  }
}
```

### å•é¡Œ 2ï¼šå…©å€‹èªè¨€æª”æ¡ˆä¸åŒæ­¥
```bash
# âœ… å¿…é ˆç¢ºä¿ en.json å’Œ zh-TW.json æœ‰ç›¸åŒçš„ key çµæ§‹
# ä½¿ç”¨é©—è­‰è…³æœ¬æª¢æŸ¥
pnpm validate:i18n
```

### å•é¡Œ 3ï¼šç¡¬ç·¨ç¢¼ä¸­æ–‡
```typescript
// âŒ éŒ¯èª¤ï¼šç¡¬ç·¨ç¢¼æ–‡å­—
<Button>å„²å­˜</Button>

// âœ… æ­£ç¢ºï¼šä½¿ç”¨ç¿»è­¯
<Button>{t('actions.save')}</Button>
```

### å•é¡Œ 4ï¼šä½¿ç”¨ä¸å­˜åœ¨çš„ Key
```typescript
// âŒ éŒ¯èª¤ï¼škey ä¸å­˜åœ¨æœƒå°è‡´ IntlError
t('messages.search')  // ä½†å¯¦éš› key æ˜¯ 'searchPlaceholder'

// âœ… æ­£ç¢ºï¼šå…ˆç¢ºèª key å­˜åœ¨ï¼Œå†ä½¿ç”¨
// 1. æª¢æŸ¥ç¿»è­¯æª”æ¡ˆä¸­æ˜¯å¦æœ‰æ­¤ key
// 2. å¦‚æœæ²’æœ‰ï¼Œå…ˆæ·»åŠ å†ä½¿ç”¨
```

## AI åŠ©æ‰‹ä½¿ç”¨æŒ‡å—

### ä½¿ç”¨ç¿»è­¯ Key å‰å¿…é ˆé©—è­‰
```bash
# æ–¹æ³• 1ï¼šç›´æ¥æª¢æŸ¥
node -e "const d=require('./apps/web/src/messages/zh-TW.json'); console.log(d.common?.actions?.search);"

# æ–¹æ³• 2ï¼šé‹è¡Œé©—è­‰
pnpm validate:i18n
```

### æ·»åŠ æ–° Key çš„æ­£ç¢ºæµç¨‹
1. **å…ˆæ·»åŠ  Key**ï¼šåŒæ™‚æ›´æ–° `en.json` å’Œ `zh-TW.json`
2. **é‹è¡Œé©—è­‰**ï¼š`pnpm validate:i18n`
3. **å†ä½¿ç”¨ Key**ï¼šåœ¨çµ„ä»¶ä¸­ä½¿ç”¨ `t('...')`

### ç†è§£ Namespace å±¤ç´š
```typescript
// useTranslations('common.actions') â†’ t('search')
// useTranslations('common') â†’ t('actions.search')
// ä½¿ç”¨éŒ¯èª¤çš„ namespace æœƒå°è‡´ "MISSING_MESSAGE" éŒ¯èª¤
```

## é©—è­‰å·¥ä½œæµ

```bash
# å¿…é ˆåœ¨æäº¤ç¿»è­¯è®Šæ›´å‰é‹è¡Œ
pnpm validate:i18n

# é©—è­‰å…§å®¹ï¼š
# âœ… JSON èªæ³•æ­£ç¢ºæ€§
# âœ… é‡è¤‡ key æª¢æ¸¬ï¼ˆé€è¡Œè§£æï¼‰
# âœ… ç©ºå€¼æª¢æ¸¬
# âœ… å¤šèªè¨€ key ä¸€è‡´æ€§
```

## èªè¨€åˆ‡æ›

### LanguageSwitcher çµ„ä»¶
```typescript
import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next/navigation';

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const switchLocale = (newLocale: string) => {
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`);
    router.push(newPath);
  };

  return (
    <select value={locale} onChange={(e) => switchLocale(e.target.value)}>
      <option value="en">English</option>
      <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
    </select>
  );
}
```

## æ–°å¢ç¿»è­¯æª¢æŸ¥æ¸…å–®

- [ ] åŒæ™‚æ›´æ–° `en.json` å’Œ `zh-TW.json`
- [ ] ä½¿ç”¨æ­£ç¢ºçš„ key å‘½åæ ¼å¼
- [ ] æª¢æŸ¥æ˜¯å¦æœ‰é‡è¤‡ key
- [ ] é‹è¡Œ `pnpm validate:i18n`
- [ ] æ¸…é™¤ `.next/` å¿«å–ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ¸¬è©¦å…©ç¨®èªè¨€æ¨¡å¼

## ç¦æ­¢äº‹é …

1. âŒ **ç¦æ­¢ç¡¬ç·¨ç¢¼ä»»ä½•æ–‡å­—**
2. âŒ **ç¦æ­¢åªæ›´æ–°ä¸€å€‹èªè¨€æª”æ¡ˆ**
3. âŒ **ç¦æ­¢ä½¿ç”¨ç›¸åŒçš„ key åç¨±å¤šæ¬¡**
4. âŒ **ç¦æ­¢åœ¨æœªé©—è­‰ key å­˜åœ¨å‰ä½¿ç”¨**

## ç›¸é—œè³‡æº
- å®Œæ•´æŒ‡å—ï¼š`claudedocs/I18N-TRANSLATION-KEY-GUIDE.md`
- é©—è­‰è…³æœ¬ï¼š`scripts/validate-i18n.js`
- ç›¸é—œä¿®å¾©ï¼šFIX-074, FIX-075ï¼ˆé‡è¤‡ key å•é¡Œï¼‰

## ç›¸é—œè¦å‰‡
- `components.md` - React çµ„ä»¶è¦ç¯„
- `frontend.md` - å‰ç«¯é é¢è¦ç¯„
