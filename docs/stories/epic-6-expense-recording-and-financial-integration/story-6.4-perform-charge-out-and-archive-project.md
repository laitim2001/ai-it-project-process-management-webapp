# Story 6.4: 執行費用轉出 (Charge Out) 並歸檔專案

## User Story

**身為** 專案經理,
**當一個專案的所有費用都已支付完畢，我想要** 執行一個「費用轉出 (Charge Out)」的最終操作，
**以便** 完成整個專案的財務閉環並將其歸檔。

## 背景說明
「費用轉出」是專案財務生命週期的最後一個里程碑。它標誌著所有與該專案相關的費用都已結清，可以進行最終的財務核算。在我們的流程中，這是一個重要的手動觸發事件，用於確認專案的結束。執行此操作後，專案將被鎖定並歸檔，確保歷史數據的完整性和不可變性，為年度報告和審計提供乾淨、最終的數據記錄。

## 技術規格 (初步建議)
*   **前端:** 在專案詳情頁面，當滿足特定條件時（例如，所有關聯的費用都已支付），應顯示一個「執行 Charge Out」的按鈕。
*   **後端:**
    *   需要一個 API 端點 (e.g., `POST /api/projects/:id/charge-out`)。
    *   後端邏輯在執行前需要進行校驗，確保所有費用都處於「已支付」狀態。
    *   執行成功後，應更新專案的最終狀態為 `Completed` 或 `Archived`。
*   **資料庫:** `projects` 表的 `status` 欄位需要更新。可能還需要一個 `charge_out_date` 欄位來記錄操作時間。

## 驗收標準
1.  假定一個專案的所有關聯費用都已處於「已支付」狀態。
2.  我應該能在該專案的頁面上找到一個「執行費用轉出」的按鈕。
3.  在點擊按鈕並確認後，該專案的狀態應變更為「已完成」。
4.  一旦專案完成，其所有相關記錄（如提案、採購單、費用）應變為唯讀，不可再被修改。
5.  如果專案尚有未支付的費用，則「執行費用轉出」的按鈕不應顯示或應被禁用。

## 技術債務考量
*   **暫不包含：** 與外部財務系統（如 D365）的自動對接。MVP 階段的 Charge Out 是一個內部狀態變更，財務人員可能需要基於此記錄在外部系統中進行手動操作。
*   **未來考慮：** 開發一個真正的 API 對接，在執行 Charge Out 時，自動將數據同步到企業的財務總帳系統。
