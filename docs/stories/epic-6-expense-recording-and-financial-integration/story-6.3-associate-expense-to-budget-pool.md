# Story 6.3: 關聯費用至特定資金池

## User Story

**身為** 專案經理,
**在記錄費用時，我想要** 將這筆費用明確地從其所屬的「資金池 (Budget Pool)」中扣除,
**以便** 實現預算的即時追蹤和可視化。

## 背景說明
預算的準確性是專案管理的生命線。此功能是實現預算即時追蹤的核心。當一筆費用被「批准」或「支付」時，其金額必須準確地從對應的資金池中扣除。這一步確保了儀表板上顯示的預算燃盡圖和剩餘金額是即時且可靠的，從而為管理者提供了真實的財務狀況視圖，以進行有效的資金控制和規劃。

## 技術規格 (初步建議)
*   **前端:** 費用記錄表單中可能需要一個（通常是自動帶出的）欄位，顯示該費用將從哪個資金池中扣除。
*   **後端:** 當費用狀態變為 `Approved` 或 `Paid` 時（根據業務規則決定），需要觸發一個更新 `Budget Pool` 餘額的服務邏輯。這應該是一個事務性操作，以確保數據一致性。
*   **資料庫:** `budget_pools` 表需要有 `total_amount` 和 `used_amount` (或 `remaining_amount`) 欄位。當費用被核算時，需要更新這些欄位。

## 驗收標準
1.  當我創建一筆費用時，系統應能自動識別其所屬的專案，並進而確定它應從哪個資金池扣款。
2.  當一筆費用的狀態變為「已批准」（或業務規則定義的其他狀態）時，其金額必須從對應資金池的「已使用金額」中加上，同時「剩餘金額」應相應減少。
3.  我應該能在資金池的管理頁面看到即時更新的餘額。
4.  如果一筆費用被拒絕或取消，其金額不應影響資金池的餘額。

## 技術債務考量
*   **暫不包含：** 跨資金池的預算調撥功能。MVP 假設預算在資金池之間是固定的。
*   **未來考慮：** 增加預算凍結機制（當費用提交審批時，先凍結額度，批准後再實際扣除）。
