# Story 10.2: 從 HR 系統同步使用者與部門資料

## User Story

**身為** 平台管理員,
**我想要** 系統能定期地從公司的 HR 系統 (如 SAP) 中同步最新的員工列表和部門結構,
**以便** 平台內的使用者帳戶和審批層級關係能自動保持最新，無需手動維護。

## 背景說明
隨著組織的變動（人員入職、離職、轉調），手動維護平台內的使用者和組織架構是一項繁瑣且容易出錯的工作。錯誤的組織結構會導致審批流程中斷。此功能將 HR 系統作為使用者信息的「單一事實來源」，透過定期同步，確保平台內的使用者數據和匯報關係始終與公司的官方結構保持一致，從而實現使用者管理的自動化。

## 技術規格 (初步建議)
*   **後端:**
    *   需要開發一個 `HrIntegrationService`。
    *   需要一個定期的背景任務（e.g., a cron job running nightly）來觸發同步邏輯。
    *   同步邏輯：
        1.  從 HR 系統的 API 獲取完整的員工和部門列表。
        2.  與本平台資料庫中的 `users` 和 `departments` 表進行比對。
        3.  新增不存在的新員工。
        4.  更新資訊有變動的現有員工（如部門、職位）。
        5.  標記已從 HR 系統中移除的員工為「停用」狀態（而不是物理刪除，以保留歷史數據）。
*   **資料庫:** `users` 表需要一個 `hr_employee_id` 欄位作為唯一的關聯鍵。

## 驗收標準
1.  假定 HR 系統中有一個新員工「張三」被加入。
2.  在下一個同步週期（例如，次日凌晨）結束後，我應該能在本平台的用戶列表中找到「張三」這個新帳戶。
3.  假定 HR 系統中，員工「李四」的部門從「市場部」變更為「銷售部」。
4.  同步後，「李四」在本平台中的部門資訊也應自動更新為「銷售部」。
5.  假定 HR 系統中，員工「王五」已離職並被移除。
6.  同步後，「王五」在本平台中的帳戶狀態應變為「已停用」，他將無法再登入系統。

## 技術債務考量
*   **暫不包含：** 即時同步。MVP 階段採用定期的批量同步，可能會有最多 24 小時的延遲。
*   **未來考慮：** 採用事件驅動架構（如果 HR 系統支持 Webhooks），實現使用者資訊的即時變更。
