# Story 10.1: 將費用數據同步至財務系統 (ERP)

## User Story

**身為** 財務部門人員,
**我想要** 所有在本平台被批准的「費用」都能自動同步到公司的財務 ERP 系統 (如 D365),
**以便** 無需手動重複錄入即可完成記帳和支付流程，提高準確性並減少延遲。

## 背景說明
這是打通「專案執行」與「企業財務」之間壁壘的關鍵整合。目前，專案費用在批准後，仍需財務人員在 ERP 系統中手動重新創建憑證，過程耗時且容易出錯。此功能將透過 API 對接，實現數據的無縫流動，確保費用數據能準確、及時地進入企業的總帳系統，是實現端到端流程自動化的最後一里路。

## 技術規格 (初步建議)
*   **後端:**
    *   需要開發一個 `ErpIntegrationService`。
    *   該服務需要根據財務系統（如 D365）的 API 規範，進行身份驗證和數據格式轉換。
    *   當一筆費用的狀態變為「已批准」時，應觸發一個異步任務，將該筆費用的結構化數據（如金額、供應商、專案代碼、費用類別）推送到 ERP 系統的對應接口。
    *   需要有健全的錯誤處理和重試機制，以應對 API 暫時不可用或數據校驗失敗的情況。
    *   需要一個儀表板或日誌系統來監控同步任務的成功與失敗狀態。
*   **安全性:** 與 ERP 系統的連接憑證（API Key, OAuth Token）必須安全地儲存在秘密管理器中 (e.g., AWS Secrets Manager, Azure Key Vault)。

## 驗收標準
1.  假定一筆費用在本平台中被主管批准。
2.  系統應在 5 分鐘內自動嘗試將此費用數據同步到測試環境的 ERP 系統中。
3.  成功同步後，該筆費用的在本平台內的狀態應更新為「已同步至 ERP」。
4.  我應該能在 ERP 系統中查到一筆對應的、數據完全一致的待支付憑證。
5.  如果同步因網路或數據格式問題失敗，系統應在日誌中記錄詳細的錯誤資訊，並在 1 小時後自動重試最多 3 次。

## 技術債務考量
*   **暫不包含：** 雙向同步。MVP 階段是從本平台到 ERP 的單向數據推送。ERP 中的狀態變更（如「已支付」）不會反向同步回本平台。
*   **未來考慮：** 實現雙向數據同步，讓專案經理可以在本平台內直接看到 ERP 中的支付狀態。
