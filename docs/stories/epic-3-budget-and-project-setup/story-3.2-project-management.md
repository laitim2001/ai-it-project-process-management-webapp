# Story 3.2: 專案 (Project) 管理

> **🔴 MVP Priority: Phase 1** - 核心業務流程的開端
> **⏱️ 預估工作量**: 3-4 天
> **👥 需要角色**: 後端開發者, 前端開發者

## User Story

身為專案經理，
我想要一個管理介面來建立和查看我負責的所有專案，
以便我可以對專案的基本資訊進行集中管理，並將其與特定的資金來源關聯。

## 背景說明

在資金池建立之後，下一步就是定義具體的專案。專案是所有後續活動（提案、採購、費用）的載體。此功能旨在提供一個清晰的介面，讓經理能夠創建專案，並確保每個專案都連結到一個已定義的預算分類，從而建立起資金流動的第一步追蹤。

## 技術規格 (初步建議)

*   **資料庫模型 (Prisma Schema):**
    *   在 `schema.prisma` 中新增一個 `Project` 模型。
    *   `Project` 模型至少應包含：
        *   `id`: `Int` (主鍵)
        *   `name`: `String`
        *   `description`: `String` (或 `Text`)
        *   `picId`: `Int` (負責人的 User ID)
        *   `startDate`: `DateTime`
        *   `endDate`: `DateTime`
        *   `budgetPoolId`: `Int` (關聯的 Budget Pool ID)
    *   **關聯 (Relation):**
        *   `Project` 模型需要與 `User` 模型建立關聯（透過 `picId`），代表專案負責人。
        *   `Project` 模型需要與 `BudgetPool` 模型建立關聯（透過 `budgetPoolId`），代表資金來源。
*   **後端 (NestJS):**
    *   建立一個新的模組 `ProjectModule`。
    *   建立 `ProjectController`，設定 API 端點，需受 **JWT 認證 (JwtAuthGuard)** 保護。
        *   `POST /api/projects`: 建立一個新專案。
        *   `GET /api/projects`: 獲取專案列表。
    *   建立 `ProjectService` 來處理業務邏輯：
        *   在建立專案時，`picId` 應自動設定為當前登入使用者的 ID。
        *   在獲取專案列表時，需根據使用者角色進行過濾：`MANAGER` 只能看到自己負責的專案，`SUPERVISOR` 可以看到所有專案。
*   **前端 (Next.js):**
    *   建立一個新的頁面，路由為 `/manager/projects`。
    *   頁面包含一個「新增專案」的按鈕，點擊後會彈出一個表單（或跳轉到新頁面）。
    *   表單中，「資金池分類」應以**下拉選單**的形式呈現，其選項應來自 `GET /api/budget-pools` 的數據。
    *   頁面以表格形式展示專案列表，並根據使用者角色顯示對應的數據。

## 驗收標準

### 1. 資料庫與後端：
*   成功執行 `prisma migrate dev` 後，資料庫中已建立 `Project` 資料表，並包含正確的外鍵關聯。
*   `POST /api/projects` 端點：
    *   任何已登入的使用者都可以呼叫。
    *   成功建立專案後，返回的數據中 `picId` 應為當前使用者的 ID。
    *   如果提供的 `budgetPoolId` 不存在，應返回 `400 Bad Request` 錯誤。
*   `GET /api/projects` 端點：
    *   當以 `MANAGER` 角色呼叫時，返回的列表應只包含該使用者負責的專案。
    *   當以 `SUPERVISOR` 角色呼叫時，返回的列表應包含所有專案。

### 2. 前端介面：
*   `MANAGER` 和 `SUPERVISOR` 角色的使用者登入後，都可以在導航欄中看到並訪問「專案管理」頁面。
*   在「新增專案」的表單中，「資金池分類」的下拉選單能成功載入並顯示所有可用的預算分類。
*   專案經理成功建立新專案後，可以在專案列表中看到該項目。
*   部門主管登入後，可以在專案列表中看到所有經理建立的專案。
*   專案列表應清晰展示 `專案名稱`、`負責人`、`關聯預算`、`起止日期` 等資訊。

## 技術債務考量
*   **編輯與刪除功能:** 與資金池一樣，MVP 階段暫不提供專案的「編輯」和「刪除」功能，以簡化權限管理和確保數據流的完整性。
*   **PIC 指派:** 目前負責人 (PIC) 預設為創建者。未來可能需要增加更靈活的指派功能，允許主管將專案指派給其他經理。
*   **多個負責人:** MVP 階段一個專案只有一個負責人。未來可能需要支援多個協作者或負責人。
