# Story 9.3: 預測性預算風險警示

## User Story

**身為** 部門主管,
**我想要** AI 助理能持續監控專案的預算消耗速度，並在出現超支風險時主動向我發出警示,
**以便** 我能及早發現問題並進行干預，避免財務失控。

## 背景說明
被動地查看報表只能發現已經發生的問題。此功能旨在將財務監控從「被動回顧」轉變為「主動預警」。AI 助理將像一個警惕的財務分析師，不僅僅是報告當前的數字，而是基於專案的歷史支出模式、時間進度和已記錄的未來承諾（如採購單），來預測未來的現金流。當預測顯示有偏離預算的風險時，它會提前發出警告，給予管理者寶貴的時間來進行調整。

## 技術規格 (初步建議)
*   **後端:**
    *   需要一個定期的背景任務（e.g., a cron job running daily）來觸發 `BudgetForecastingService`。
    *   該服務會分析每個活躍專案的 `expenses` 和 `purchase_orders`。
    *   它會使用簡單的時間序列分析或趨勢預測模型，來預測專案在結項時的總支出。
    *   如果預測支出超過了專案總預算的一定閾值（例如 90%），則會生成一個警示事件。
*   **通知:** 警示事件會觸發 `NotificationService`，向專案的負責主管發送一封包含詳細風險分析的電子郵件。
*   **前端:** 在主管儀表板上，有超支風險的專案或資金池應以特殊的顏色（如黃色或紅色）標記出來。

## 驗收標準
1.  假定一個專案的預算為 $10,000，計劃時長為 10 個月。在第 2 個月時，已批准的費用和採購單總額已達到 $5,000。
2.  系統的背景任務在分析後，應能識別出此專案的支出速度遠超預期。
3.  對應的部門主管應收到一封標題為「預算風險警示」的郵件。
4.  郵件內容應明確指出是哪個專案有風險，其當前支出狀況，以及預計的超支金額。
5.  在主管的儀表板上，該專案的預算狀態應被高亮顯示。

## 技術債務考量
*   **暫不包含：** 複雜的機器學習預測模型。MVP 階段可以使用基於線性趨勢的簡單預測。
*   **未來考慮：** 引入更複雜的預測模型，考慮季節性、專案類型等更多變數，以提高預測的準確性。
